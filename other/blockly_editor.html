
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockly Metamodel Editor</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/msg/en.js"></script>
    <style>
        body { margin: 0; }
        #blocklyDiv { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
        }
    </style>
</head>
<body>
    <div id="blocklyDiv"></div>
    
    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox">
        <block type="Pipeline"></block><block type="Job"></block><block type="Command"></block><block type="Environment"></block><block type="When"></block><block type="Artifact"></block><block type="Tool"></block><block type="IfThenElse"></block><block type="Parameter"></block><block type="Permission"></block><block type="If"></block><block type="Else"></block>
    </xml>

    <script>
        // Custom block definitions
        const blockDefinitions = {
  "Pipeline": {
    "type": "Pipeline",
    "message0": "Pipeline Attributes Containments",
    "args0": [
      {
        "type": "field_input",
        "name": "Name",
        "text": "Name"
      },
      {
        "type": "field_input",
        "name": "Concurrent",
        "text": "Concurrent"
      },
      {
        "type": "input_value",
        "name": "when",
        "check": [
          "When"
        ]
      },
      {
        "type": "input_value",
        "name": "job",
        "check": [
          "Job"
        ]
      },
      {
        "type": "input_value",
        "name": "tool",
        "check": [
          "Tool"
        ]
      },
      {
        "type": "input_value",
        "name": "environment",
        "check": [
          "Environment"
        ]
      },
      {
        "type": "input_value",
        "name": "permission",
        "check": [
          "Permission"
        ]
      }
    ],
    "colour": 164,
    "previousStatement": null,
    "nextStatement": null
  },
  "Job": {
    "type": "Job",
    "message0": "Job Attributes Containments",
    "args0": [
      {
        "type": "field_input",
        "name": "Name",
        "text": "Name"
      },
      {
        "type": "field_input",
        "name": "AllowFailure",
        "text": "AllowFailure"
      },
      {
        "type": "field_input",
        "name": "Description",
        "text": "Description"
      },
      {
        "type": "input_value",
        "name": "tool",
        "check": [
          "Tool"
        ]
      },
      {
        "type": "input_value",
        "name": "command",
        "check": [
          "Command"
        ]
      },
      {
        "type": "input_value",
        "name": "ifthenelse",
        "check": [
          "IfThenElse"
        ]
      },
      {
        "type": "input_value",
        "name": "input",
        "check": [
          "Artifact"
        ]
      },
      {
        "type": "input_value",
        "name": "environment",
        "check": [
          "Environment"
        ]
      },
      {
        "type": "input_value",
        "name": "permission",
        "check": [
          "Permission"
        ]
      }
    ],
    "colour": 132,
    "previousStatement": null,
    "nextStatement": null
  },
  "Command": {
    "type": "Command",
    "message0": "Command Attributes Containments",
    "args0": [
      {
        "type": "field_input",
        "name": "Name",
        "text": "Name"
      },
      {
        "type": "input_value",
        "name": "tool",
        "check": [
          "Tool"
        ]
      },
      {
        "type": "input_value",
        "name": "parameter",
        "check": [
          "Parameter"
        ]
      }
    ],
    "colour": 170,
    "previousStatement": null,
    "nextStatement": null
  },
  "Environment": {
    "type": "Environment",
    "message0": "Environment Attributes",
    "args0": [
      {
        "type": "field_input",
        "name": "Key",
        "text": "Key"
      },
      {
        "type": "field_input",
        "name": "Value",
        "text": "Value"
      }
    ],
    "colour": 276
  },
  "When": {
    "type": "When",
    "message0": "When Attributes",
    "args0": [
      {
        "type": "field_input",
        "name": "Name",
        "text": "Name"
      },
      {
        "type": "field_input",
        "name": "Trigger",
        "text": "Trigger"
      },
      {
        "type": "field_input",
        "name": "Timer",
        "text": "Timer"
      }
    ],
    "colour": 36
  },
  "Artifact": {
    "type": "Artifact",
    "message0": "Artifact Attributes",
    "args0": [
      {
        "type": "field_input",
        "name": "Name",
        "text": "Name"
      }
    ],
    "colour": 349
  },
  "Tool": {
    "type": "Tool",
    "message0": "Tool Attributes",
    "args0": [
      {
        "type": "field_input",
        "name": "Name",
        "text": "Name"
      }
    ],
    "colour": 337
  },
  "IfThenElse": {
    "type": "IfThenElse",
    "message0": "IfThenElse Attributes Containments",
    "args0": [
      {
        "type": "field_input",
        "name": "Condition",
        "text": "Condition"
      },
      {
        "type": "input_value",
        "name": "true",
        "check": [
          "If"
        ]
      },
      {
        "type": "input_value",
        "name": "false",
        "check": [
          "Else"
        ]
      }
    ],
    "colour": 185,
    "previousStatement": null,
    "nextStatement": null
  },
  "Parameter": {
    "type": "Parameter",
    "message0": "Parameter Attributes",
    "args0": [
      {
        "type": "field_input",
        "name": "Parameter",
        "text": "Parameter"
      }
    ],
    "colour": 357
  },
  "Permission": {
    "type": "Permission",
    "message0": "Permission Attributes",
    "args0": [
      {
        "type": "field_input",
        "name": "Key",
        "text": "Key"
      },
      {
        "type": "field_input",
        "name": "Value",
        "text": "Value"
      }
    ],
    "colour": 256
  },
  "If": {
    "type": "If",
    "message0": "If Containments",
    "args0": [
      {
        "type": "input_value",
        "name": "command",
        "check": [
          "Command"
        ]
      },
      {
        "type": "input_value",
        "name": "ifthenelse",
        "check": [
          "IfThenElse"
        ]
      }
    ],
    "colour": 334,
    "previousStatement": null,
    "nextStatement": null
  },
  "Else": {
    "type": "Else",
    "message0": "Else Containments",
    "args0": [
      {
        "type": "input_value",
        "name": "command",
        "check": [
          "Command"
        ]
      },
      {
        "type": "input_value",
        "name": "ifthenelse",
        "check": [
          "IfThenElse"
        ]
      }
    ],
    "colour": 146,
    "previousStatement": null,
    "nextStatement": null
  }
};
        
        // Register custom blocks
        for (const [blockType, blockDef] of Object.entries(blockDefinitions)) {
            Blockly.Blocks[blockType] = {
                init: function() {
                    this.jsonInit(blockDef);
                }
            };
        }

        // Configure Blockly workspace
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            grid: {
                spacing: 20,
                length: 3,
                colour: '#ccc',
                snap: true
            },
            trashcan: true,
            zoom: {
                controls: true,
                wheel: true,
                startScale: 1.0,
                maxScale: 3,
                minScale: 0.3,
                scaleSpeed: 1.2
            }
        });
    </script>
</body>
</html>
    